---
title: "Introducing 'fulltext'"
author: "Andreas BlÃ¤tte (andreas.blaette@uni-due.de)"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{fulltext}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

## Purpose

The annolite-package includes a lightweight htmlwidget for fulltext output.

## Getting Started

```{r, eval = TRUE}
library(janeaustenr)
library(tokenizers)
library(annolite)
library(polmineR)
library(crosstalk)
```


## From a polmineR subcorpus to fulltext

We introduce the fulltext package by example. In addition to the fulltext package, we need the polmineR package which includes the GERMAPARLMINI corpus.

```{r, eval = TRUE}
library(polmineR)
use("polmineR")
```

The example aims at outputting one particular speech. We take a speech held by Voker Kauder in the German Bundestag.

```{r, eval = TRUE}
sp <- corpus("GERMAPARLMINI") %>% subset(speaker == "Volker Kauder" & date == "2009-11-10")
```

The data that is passed to the JavaScript that generates the output. Expected to be a list of lists that provide data on sections of text. Each of the sub-lists is to be a named list of a character vector with the HTML element the section will be wrapped into, and  a `data.frame` (or a list) with a column "token", and a column "id".

```{r, eval = TRUE}
k <- fulltextlist(sp)
```

So let us see the result ... 

```{r, eval = TRUE}
fulltext(k)
```

```{r}
m <- cpos(sp, query = "Opposition")
anno <- data.frame(color = "yellow", start = m[,1], end = m[,2])
fulltext(k, annotations = anno, box = TRUE)
```

Add a headline

```{r}
h2 <- fulltextlist(c("Volker", "Kauder", "(CDU)"), element = "h2")
fulltext(c(h2, k))
```




## Creating fulltext

```{r, eval = TRUE}
emma_chapters <- split(
  emma,
  cut(1L:length(emma), c(1L, grep("^CHAPTER.*$", emma), length(emma)), right = FALSE)
)
emma_chapters[[1]] <- NULL

emma_chapters <- lapply(
  seq_along(emma_chapters_tokenized),
  function(i){
    fulltextlist_paras <- lapply(
      emma_chapters_tokenized[[i]],
      fulltextlist, element = "p"
    )
    y <- do.call(c, fulltextlist_paras)
    name(y) <- sprintf("Chapter %s", i)
    y
  }
)
```


```{r, eval = TRUE}
fulltext(emma_chapters[[1]])
```


## Crosstalking

```{r, eval = TRUE}
fulltext(emma_chapters[1:5])
```


## Perspectives

Enjoy! 